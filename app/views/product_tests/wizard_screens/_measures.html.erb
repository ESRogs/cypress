<% content_for :head do %>
  <style type="text/css">
    .measure_group {margin-left:.5em;}
    .measure_group label {text-indent:5em;}
  </style>

  <script type="text/javascript">
    function tallyMeasureGroups() {
      var grandTotal = 0;
      $.each($('.measure_group'), function(index, item){
        var total = Math.max(0,$(this).find('input.measure_cb:checked').length);
        $('#' + $(item).attr('id') +'_group').prop('checked', $(this).find('input.measure_cb').length == total);
        grandTotal += total;
        $('#' + $(item).attr('id') +'_group_total').empty().html(total > 0 ? total : '');
      });
      $('#all_measures').prop('checked',$('#wizard-measures-screen input.measure_cb').length == grandTotal)
      // clear the coverage map
      $('#measure_coverage').empty()
    };

    $(document).ready(function() {
      // for handling the selection of measures from groups
      $('#all_measures').click(function () {
        $('#wizard-measures-screen input:checkbox').prop('checked', $(this).prop('checked'));
        $('.measure_group').prop('checked', $(this).prop('checked'));
        tallyMeasureGroups();
      });
      $('.measure_group_all').click(function () {
        var groupName = $(this).attr('id');
        $(this).closest('div').find('input:checkbox').prop('checked', $(this).prop('checked'));
        tallyMeasureGroups();
      });

      $('.measure_cb').change(function() {
        tallyMeasureGroups();
      });
    });

  </script>
<% end %>

<section id="wizard-measures-screen" class="step">
  <h2 class="ui-widget-title" style="margin-top: 20px;">Identify <strong>at least one</strong> quality measure to test...</h2>
  <span class="header_commands" style="text-align:center;"><input type="checkbox" id="all_measures"/><label for="all_measures">all quality measures</label></span>
  <div id="tabs">
    <!-- set up a tab header for each measure group -->
    <ul>
      <% @measures_categories.sort.each do |category, measures| %>
        <li>
          <a href="#<%= category.tr(" '", "_") %>"><%= category %></a><span style="padding-top:.5em;text-align:right;padding-right:5px;" id="<%= category.tr(" '", "_") %>_group_total"></span></li>
      <% end %>
    </ul>
    <!-- set up a tab for each measure group -->
    <% @measures_categories.sort.each do |category, measures| %>
      <div id="<%= category.tr(" '", "_")%>" class="measure_group"> <span class="header_commands"><input type="checkbox" id="<%= category.tr(" '", "_")%>_group" class="measure_group_all"/><label for="<%= category.tr(" '", "_")%>_group">all <%= category %> measures</label></span><br/>
          <%= f.collection_check_boxes :measure_ids, measures, :measure_id, :display_name, {}, {"class"=>["measure_cb", category.tr(" '", "_")]} %>
      </div>
    <% end %>
  </div>
</section>

